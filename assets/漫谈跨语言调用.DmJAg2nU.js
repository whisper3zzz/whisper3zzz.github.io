import{_ as g}from"./ValaxyMain.vue_vue_type_script_setup_true_lang.UeO0aKI3.js";import"./chunks/pinia.BFamNAX0.js";import{e as y,u as F,a as u}from"./chunks/vue-router.CLlYW99z.js";import{a7 as o,an as a,X as C,a8 as A,am as h,ac as c,af as i,aj as s,Z as D}from"./framework.DIdR4KMW.js";import"./app.D31Dy1By.js";import"./chunks/dayjs.BdcnXKr1.js";import"./chunks/vue-i18n.C-hb0qar.js";/* empty css                    */import"./chunks/nprogress.B6x19dEb.js";import"./content.DZLhsl5J.js";import"./router.-rV2tM5K.js";const B=y("/posts/漫谈跨语言调用/漫谈跨语言调用",async n=>JSON.parse('{"title":"漫谈跨语言调用","description":"","frontmatter":{"title":"漫谈跨语言调用","excerpt_type":"html","date":"2025-10-29"},"headers":[],"relativePath":"pages/posts/漫谈跨语言调用/漫谈跨语言调用.md","lastUpdated":1761835150000}'),{lazy:(n,t)=>n.name===t.name}),G={__name:"漫谈跨语言调用",setup(n,{expose:t}){const{data:p}=B(),r=u(),E=F(),e=Object.assign(E.meta.frontmatter||{},p.value?.frontmatter||{});return r.currentRoute.value.data=p.value,D("valaxy:frontmatter",e),globalThis.$frontmatter=e,t({frontmatter:{title:"漫谈跨语言调用",excerpt_type:"html",date:"2025-10-29"}}),(k,l)=>{const d=g;return A(),o(d,{frontmatter:C(e)},{"main-content-md":a(()=>[c(" more "),l[0]||(l[0]=i("p",null,"C/C++、C#、Lua、JS/TS的跨语言调用",-1)),l[1]||(l[1]=i("h2",{id:"引言-为什么需要跨语言调用",tabindex:"-1"},[s("引言：为什么需要跨语言调用 "),i("a",{class:"header-anchor",href:"#引言-为什么需要跨语言调用","aria-label":'Permalink to "引言：为什么需要跨语言调用"'},"​")],-1)),l[2]||(l[2]=i("h3",{id:"从游戏开发的角度出发",tabindex:"-1"},[s("从游戏开发的角度出发 "),i("a",{class:"header-anchor",href:"#从游戏开发的角度出发","aria-label":'Permalink to "从游戏开发的角度出发"'},"​")],-1)),l[3]||(l[3]=i("p",null,"对于游戏开发而言，跨语言调用无论在提升开发效率还是降低成本方面，都是一剂良药。特别是在商业游戏开发中，将部分业务逻辑使用 Lua、JavaScript/TypeScript 等脚本语言实现，并交由外包团队编写，可以有效降低开发成本。同时，脚本语言的热更新特性使得开发团队能够快速修复线上的严重 Bug，无需重新发包，也无需等待 App Store 等应用商店的审核流程，从而显著提升玩家体验。",-1)),l[4]||(l[4]=i("h3",{id:"编译型语言-vs-解释型语言",tabindex:"-1"},[s("编译型语言 VS 解释型语言 "),i("a",{class:"header-anchor",href:"#编译型语言-vs-解释型语言","aria-label":'Permalink to "编译型语言 VS 解释型语言"'},"​")],-1)),l[5]||(l[5]=i("p",null,"从语言类型来看，C/C++ 属于编译型语言，通过编译器直接编译为汇编代码，最终生成机器码。而 Lua、JavaScript/TypeScript 等脚本语言则属于解释型语言，这类语言通过虚拟机（解释器）逐行解释执行代码。",-1)),l[6]||(l[6]=i("p",null,"C# 的实现方式则较为特殊：源代码首先由编译器编译为中间语言（IL），然后在运行时由 CLR（公共语言运行时）解释执行 IL 代码。",-1)),l[7]||(l[7]=i("p",null,'值得注意的是，"编译型语言"与"解释型语言"的划分更多是早期的习惯性称呼。现代的 Lua 早已采用了类似 C# 的实现方案——先将源代码编译为字节码（中间语言），再由虚拟机解释执行，从而在性能和灵活性之间取得平衡。',-1)),l[8]||(l[8]=i("h3",{id:"托管代码与原生代码",tabindex:"-1"},[s("托管代码与原生代码 "),i("a",{class:"header-anchor",href:"#托管代码与原生代码","aria-label":'Permalink to "托管代码与原生代码"'},"​")],-1)),l[9]||(l[9]=i("p",null,[s("理解跨语言调用的关键在于区分"),i("strong",null,"托管代码"),s("（Managed Code）与"),i("strong",null,"原生代码"),s("（Native Code）：")],-1)),l[10]||(l[10]=i("ul",null,[i("li",null,[i("p",null,[i("strong",null,"原生代码"),s("：如 C/C++ 编译后的机器码，直接在 CPU 上执行，拥有最高的性能和最底层的系统访问权限。开发者需要手动管理内存（malloc/free、new/delete），对内存布局有完全的控制权。")])]),i("li",null,[i("p",null,[i("strong",null,"托管代码"),s("：如 C#、Java、Lua 等语言的代码，运行在虚拟机之上。虚拟机提供了自动内存管理（垃圾回收）、类型安全检查、异常处理等高级特性，降低了开发难度，但也引入了一定的性能开销。")])])],-1)),l[11]||(l[11]=i("p",null,"跨语言调用的本质，就是在这两种不同的执行环境之间建立桥梁，使它们能够相互通信和协作。",-1)),l[12]||(l[12]=i("h2",{id:"一、必备基础知识",tabindex:"-1"},[s("一、必备基础知识 "),i("a",{class:"header-anchor",href:"#一、必备基础知识","aria-label":'Permalink to "一、必备基础知识"'},"​")],-1)),l[13]||(l[13]=i("p",null,'在深入跨语言调用的具体实现之前，需要掌握一些计算机底层的基础知识。这些知识将帮助我们理解不同语言之间是如何"对话"的。',-1)),l[14]||(l[14]=i("h3",{id:"_1-1-计算机基础-函数调用的底层机制",tabindex:"-1"},[s("1.1 计算机基础：函数调用的底层机制 "),i("a",{class:"header-anchor",href:"#_1-1-计算机基础-函数调用的底层机制","aria-label":'Permalink to "1.1 计算机基础：函数调用的底层机制"'},"​")],-1)),l[15]||(l[15]=i("h4",{id:"cpu、内存与寄存器",tabindex:"-1"},[s("CPU、内存与寄存器 "),i("a",{class:"header-anchor",href:"#cpu、内存与寄存器","aria-label":'Permalink to "CPU、内存与寄存器"'},"​")],-1)),l[16]||(l[16]=i("p",null,"当程序运行时，代码和数据都存储在内存中。CPU 通过寄存器（Register）来暂存计算过程中的数据。寄存器是 CPU 内部速度最快的存储单元，常见的寄存器包括：",-1)),l[17]||(l[17]=i("ul",null,[i("li",null,[i("strong",null,"通用寄存器"),s("：如"),i("code",null,"eax"),s("、"),i("code",null,"ebx"),s("、"),i("code",null,"ecx"),s("、"),i("code",null,"edx"),s(" 等，用于存储临时数据和计算结果")]),i("li",null,[i("strong",null,"栈指针寄存器"),s("（"),i("code",null,"esp"),s("）：指向当前栈顶位置")]),i("li",null,[i("strong",null,"基址指针寄存器"),s("（"),i("code",null,"ebp"),s("）：指向当前函数栈帧的基址")]),i("li",null,[i("strong",null,"指令指针寄存器"),s("（"),i("code",null,"eip"),s("）：指向下一条要执行的指令地址")])],-1)),l[18]||(l[18]=i("h4",{id:"函数调用栈与栈帧",tabindex:"-1"},[s("函数调用栈与栈帧 "),i("a",{class:"header-anchor",href:"#函数调用栈与栈帧","aria-label":'Permalink to "函数调用栈与栈帧"'},"​")],-1)),l[19]||(l[19]=i("p",null,[s("函数调用的核心机制是"),i("strong",null,"调用栈"),s("（Call Stack）。每当调用一个函数时，系统会在栈上分配一块内存区域，称为"),i("strong",null,"栈帧"),s("（Stack Frame），用于存储：")],-1)),l[20]||(l[20]=i("ol",null,[i("li",null,[i("strong",null,"函数参数"),s("：传递给函数的参数值")]),i("li",null,[i("strong",null,"返回地址"),s("：函数执行完毕后应该返回到哪里继续执行")]),i("li",null,[i("strong",null,"局部变量"),s("：函数内部定义的变量")]),i("li",null,[i("strong",null,"保存的寄存器值"),s("：调用前需要保存的寄存器状态")])],-1)),l[21]||(l[21]=i("p",null,"函数调用的基本流程：",-1)),l[22]||(l[22]=i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"1. 调用者将参数压入栈（或放入寄存器）")]),s(`
`),i("span",{class:"line"},[i("span",null,"2. 调用者执行 CALL 指令，将返回地址压栈，跳转到被调用函数")]),s(`
`),i("span",{class:"line"},[i("span",null,"3. 被调用函数保存旧的 ebp，设置新的栈帧")]),s(`
`),i("span",{class:"line"},[i("span",null,"4. 被调用函数执行函数体")]),s(`
`),i("span",{class:"line"},[i("span",null,"5. 被调用函数将返回值放入约定的位置（通常是 eax 寄存器）")]),s(`
`),i("span",{class:"line"},[i("span",null,"6. 被调用函数恢复栈帧，执行 RET 指令返回")]),s(`
`),i("span",{class:"line"},[i("span",null,"7. 调用者从约定位置获取返回值，继续执行")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[23]||(l[23]=i("h4",{id:"地址空间与指针",tabindex:"-1"},[s("地址空间与指针 "),i("a",{class:"header-anchor",href:"#地址空间与指针","aria-label":'Permalink to "地址空间与指针"'},"​")],-1)),l[24]||(l[24]=i("p",null,"每个进程都有自己独立的虚拟地址空间，通常分为几个区域：",-1)),l[25]||(l[25]=i("ul",null,[i("li",null,[i("strong",null,"代码段"),s("（Text Segment）：存储程序的机器码指令，通常是只读的")]),i("li",null,[i("strong",null,"数据段"),s("（Data Segment）：存储全局变量和静态变量")]),i("li",null,[i("strong",null,"堆"),s("（Heap）：动态分配的内存区域，由程序员手动管理（C/C++）或由垃圾回收器管理（脚本语言）")]),i("li",null,[i("strong",null,"栈"),s("（Stack）：存储函数调用栈帧，自动管理，大小有限")])],-1)),l[26]||(l[26]=i("p",null,[i("strong",null,"指针"),s("是存储内存地址的变量。在跨语言调用中，指针是传递复杂数据结构的关键手段。例如，C 函数可能返回一个指向结构体的指针，脚本语言需要正确解释这个地址并访问其中的数据。")],-1)),l[27]||(l[27]=i("h3",{id:"_1-2-语言运行时与虚拟机",tabindex:"-1"},[s("1.2 语言运行时与虚拟机 "),i("a",{class:"header-anchor",href:"#_1-2-语言运行时与虚拟机","aria-label":'Permalink to "1.2 语言运行时与虚拟机"'},"​")],-1)),l[28]||(l[28]=i("h4",{id:"虚拟机的概念",tabindex:"-1"},[s("虚拟机的概念 "),i("a",{class:"header-anchor",href:"#虚拟机的概念","aria-label":'Permalink to "虚拟机的概念"'},"​")],-1)),l[29]||(l[29]=i("p",null,"虚拟机（Virtual Machine）是一个软件层，模拟了一个抽象的计算机环境。常见的虚拟机包括：",-1)),l[30]||(l[30]=i("ul",null,[i("li",null,[i("strong",null,"Lua VM"),s("：基于寄存器的虚拟机，执行 Lua 字节码")]),i("li",null,[i("strong",null,"CLR"),s("（Common Language Runtime）：.NET 的运行时，执行 IL（中间语言）")]),i("li",null,[i("strong",null,"V8"),s("：Google 的 JavaScript 引擎，使用 JIT（即时编译）技术将 JavaScript 编译为机器码")])],-1)),l[31]||(l[31]=i("p",null,"虚拟机提供了：",-1)),l[32]||(l[32]=i("ol",null,[i("li",null,[i("strong",null,"字节码解释执行"),s("：将中间语言翻译为机器指令")]),i("li",null,[i("strong",null,"内存管理"),s("：自动分配和回收内存")]),i("li",null,[i("strong",null,"类型系统"),s("：运行时类型检查和转换")]),i("li",null,[i("strong",null,"异常处理"),s("：统一的错误处理机制")])],-1)),l[33]||(l[33]=i("h4",{id:"垃圾回收-garbage-collection",tabindex:"-1"},[s("垃圾回收（Garbage Collection） "),i("a",{class:"header-anchor",href:"#垃圾回收-garbage-collection","aria-label":'Permalink to "垃圾回收（Garbage Collection）"'},"​")],-1)),l[34]||(l[34]=i("p",null,"垃圾回收器（GC）自动管理内存，回收不再使用的对象。常见的 GC 算法包括：",-1)),l[35]||(l[35]=i("ul",null,[i("li",null,[i("strong",null,"引用计数"),s("（Reference Counting）：Lua 5.0 之前使用，简单但无法处理循环引用")]),i("li",null,[i("strong",null,"标记-清除"),s("（Mark-Sweep）：Lua 5.1+ 使用，分为标记阶段和清除阶段")]),i("li",null,[i("strong",null,"分代回收"),s('（Generational GC）：.NET、V8 使用，基于"大部分对象都很快死亡"的假设')]),i("li",null,[i("strong",null,"增量回收"),s("（Incremental GC）：将 GC 工作分散到多个时间片，减少停顿")])],-1)),l[36]||(l[36]=i("p",null,[i("strong",null,"跨语言调用中的 GC 问题"),s("：")],-1)),l[37]||(l[37]=i("ul",null,[i("li",null,"原生代码持有托管对象的指针时，必须防止对象被 GC 回收"),i("li",null,"托管代码持有原生内存时，需要在对象被回收时释放原生内存（使用 finalizer 或析构函数）")],-1)),l[38]||(l[38]=i("h4",{id:"类型系统-静态类型-vs-动态类型",tabindex:"-1"},[s("类型系统：静态类型 vs 动态类型 "),i("a",{class:"header-anchor",href:"#类型系统-静态类型-vs-动态类型","aria-label":'Permalink to "类型系统：静态类型 vs 动态类型"'},"​")],-1)),l[39]||(l[39]=i("ul",null,[i("li",null,[i("strong",null,"静态类型语言"),s("（C/C++、C#、Java）：编译时确定变量类型，类型错误在编译期发现，性能更高")]),i("li",null,[i("strong",null,"动态类型语言"),s("（Lua、JavaScript）：运行时确定变量类型，更灵活但性能较低")])],-1)),l[40]||(l[40]=i("p",null,"跨语言调用时，需要在两种类型系统之间进行转换：",-1)),l[41]||(l[41]=i("ul",null,[i("li",null,[s("C 的 "),i("code",null,"int"),s(" 对应 Lua 的 "),i("code",null,"number")]),i("li",null,[s("C 的 "),i("code",null,"char*"),s(" 对应 Lua 的 "),i("code",null,"string")]),i("li",null,[s("C 的结构体指针对应 Lua 的 "),i("code",null,"userdata")])],-1)),l[42]||(l[42]=i("p",null,"这种转换通常由语言的 FFI 层自动完成，但开发者需要理解其中的映射关系和潜在的性能开销。",-1)),l[43]||(l[43]=i("h2",{id:"二、核心概念",tabindex:"-1"},[s("二、核心概念 "),i("a",{class:"header-anchor",href:"#二、核心概念","aria-label":'Permalink to "二、核心概念"'},"​")],-1)),l[44]||(l[44]=i("h3",{id:"_2-1-abi-application-binary-interface",tabindex:"-1"},[s("2.1 ABI（Application Binary Interface） "),i("a",{class:"header-anchor",href:"#_2-1-abi-application-binary-interface","aria-label":'Permalink to "2.1 ABI（Application Binary Interface）"'},"​")],-1)),l[45]||(l[45]=i("p",null,"ABI 定义了二进制层面的接口规范，包括：",-1)),l[46]||(l[46]=i("ul",null,[i("li",null,"数据类型的大小和对齐方式"),i("li",null,"函数调用约定"),i("li",null,"系统调用接口"),i("li",null,"目标文件格式（如 ELF、PE）")],-1)),l[47]||(l[47]=i("p",null,"不同编译器、不同编译选项可能产生不兼容的 ABI。跨语言调用时，必须确保双方遵循相同的 ABI 规范。",-1)),l[48]||(l[48]=i("h3",{id:"_2-2-为什么-c-c-是跨语言调用的通用桥梁",tabindex:"-1"},[s("2.2 为什么 C/C++ 是跨语言调用的通用桥梁 "),i("a",{class:"header-anchor",href:"#_2-2-为什么-c-c-是跨语言调用的通用桥梁","aria-label":'Permalink to "2.2 为什么 C/C++ 是跨语言调用的通用桥梁"'},"​")],-1)),l[49]||(l[49]=i("p",null,"几乎所有语言之间的互调，本质上都要经过 C/C++ 层作为“中间桥梁”。",-1)),l[50]||(l[50]=i("h4",{id:"c-abi-为事实上的-通用二进制接口标准",tabindex:"-1"},[s("C ABI 为事实上的“通用二进制接口标准” "),i("a",{class:"header-anchor",href:"#c-abi-为事实上的-通用二进制接口标准","aria-label":'Permalink to "C ABI 为事实上的“通用二进制接口标准”"'},"​")],-1)),l[51]||(l[51]=i("ul",null,[i("li",null,"操作系统 API 面向 C：Windows API、POSIX 接口都以 C 函数与结构体定义为主。"),i("li",null,"绝大多数 FFI（Foreign Function Interface，外部函数接口）都围绕 C 的 ABI（Application Binary Interface，应用二进制接口）建立。"),i("li",null,'动态库边界以 C 为准：dlopen/LoadLibrary 加载的函数符号，默认遵循 C 调用约定与命名规则（配合 extern "C"）。'),i("li",null,"C 语义最小、公约数最大：无对象模型、无隐藏 vtable、无异常传播约定，跨编译器/跨平台最稳定。"),i("li",null,"C++ 的ABI 不稳定：不同编译器与平台的 name mangling、对象布局、异常约定差异较大，跨边界需要显式 C 包装。"),i("li",null,"几乎所有语言与运行时（CLR、JVM、V8、Lua VM、CPython）都对外提供 C/C++ 接口。")],-1)),l[52]||(l[52]=i("h4",{id:"跨语言调用的底层机制",tabindex:"-1"},[s("跨语言调用的底层机制 "),i("a",{class:"header-anchor",href:"#跨语言调用的底层机制","aria-label":'Permalink to "跨语言调用的底层机制"'},"​")],-1)),l[53]||(l[53]=i("ul",null,[i("li",null,[s("C# ↔ C/C++： "),i("ul",null,[i("li",null,"P/Invoke、C++/CLI、Native Plugin"),i("li",null,"本质上通过 C ABI 调用导出的函数符号，CLR 负责参数封送")])]),i("li",null,[s("Lua ↔ C/C++： "),i("ul",null,[i("li",null,"Lua C API、LuaJIT FFI"),i("li",null,"本质上以 lua_State* 为中枢，栈上传参、取回结果")])]),i("li",null,[s("JavaScript/TypeScript ↔ C/C++： "),i("ul",null,[i("li",null,"V8 原生 API（Embedding）、QuickJS 原生 API"),i("li",null,"本质上引擎提供 C/C++ 接口管理 JS 对象与执行环境")])])],-1)),l[54]||(l[54]=i("h4",{id:"示例-同一个-c-函数被多语言调用",tabindex:"-1"},[s("示例：同一个 C 函数被多语言调用 "),i("a",{class:"header-anchor",href:"#示例-同一个-c-函数被多语言调用","aria-label":'Permalink to "示例：同一个 C 函数被多语言调用"'},"​")],-1)),l[55]||(l[55]=i("div",{class:"language-c"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// addlib.c")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[56]||(l[56]=i("ul",null,[i("li",null,"在 C++ 中调用（使用 C 接口规避 name mangling）：")],-1)),l[57]||(l[57]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extern"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C"'),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," main"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[58]||(l[58]=i("ul",null,[i("li",null,"在 C# 中调用（P/Invoke）：")],-1)),l[59]||(l[59]=i("div",{class:"language-csharp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"csharp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"using"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," System"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Runtime"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"InteropServices"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Native"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ["),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"DllImport"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"addlib"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CallingConvention"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CallingConvention.Cdecl)]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extern"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[60]||(l[60]=i("ul",null,[i("li",null,"在 Lua（LuaJIT）中调用（FFI）：")],-1)),l[61]||(l[61]=i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ffi "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," require"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ffi"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ffi."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cdef"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[["),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"); "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"]]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lib "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ffi."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"load"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"./addlib.so"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- Windows 下可为 addlib.dll")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(lib."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[62]||(l[62]=i("p",null,"这些示例都在调用同一个 C 函数。唯一要求是各语言侧的 FFI 层遵循相同的 C ABI。",-1)),l[63]||(l[63]=i("h3",{id:"_2-3-ffi-foreign-function-interface-深入解析",tabindex:"-1"},[s("2.3 FFI（Foreign Function Interface）深入解析 "),i("a",{class:"header-anchor",href:"#_2-3-ffi-foreign-function-interface-深入解析","aria-label":'Permalink to "2.3 FFI（Foreign Function Interface）深入解析"'},"​")],-1)),l[64]||(l[64]=i("h4",{id:"ffi-的定义和作用",tabindex:"-1"},[s("FFI 的定义和作用 "),i("a",{class:"header-anchor",href:"#ffi-的定义和作用","aria-label":'Permalink to "FFI 的定义和作用"'},"​")],-1)),l[65]||(l[65]=i("p",null,[i("strong",null,"FFI"),s("（Foreign Function Interface，外部函数接口）是一种机制，允许一种编程语言调用另一种语言编写的函数。在实践中，FFI 通常特指高级语言调用 C 语言函数的接口，因为：")],-1)),l[66]||(l[66]=i("ol",null,[i("li",null,[i("strong",null,"C 语言的通用性"),s("：C 是最接近硬件的高级语言，几乎所有操作系统 API 都提供 C 接口")]),i("li",null,[i("strong",null,"ABI 稳定性"),s("：C 的 ABI 相对简单且稳定，易于跨编译器和平台兼容")]),i("li",null,[i("strong",null,"最小公约数"),s('：C 可以作为不同语言之间的"通用语言"')])],-1)),l[67]||(l[67]=i("p",null,[s("FFI 的核心作用是"),i("strong",null,"解决类型系统和调用约定的差异"),s("，使得运行在虚拟机上的托管代码能够安全、正确地调用原生代码。")],-1)),l[68]||(l[68]=i("h4",{id:"ffi-的工作原理",tabindex:"-1"},[s("FFI 的工作原理 "),i("a",{class:"header-anchor",href:"#ffi-的工作原理","aria-label":'Permalink to "FFI 的工作原理"'},"​")],-1)),l[69]||(l[69]=i("p",null,"FFI 的工作流程可以分为以下几个步骤：",-1)),l[70]||(l[70]=i("p",null,[i("strong",null,"1. 类型映射（Type Mapping）")],-1)),l[71]||(l[71]=i("p",null,"FFI 需要在两种语言的类型系统之间建立映射关系。例如，Lua 调用 C 函数时：",-1)),l[72]||(l[72]=i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"Lua 类型          →    C 类型")]),s(`
`),i("span",{class:"line"},[i("span",null,"-----------------------------------------")]),s(`
`),i("span",{class:"line"},[i("span",null,"number           →    int / double / float")]),s(`
`),i("span",{class:"line"},[i("span",null,"string           →    const char*")]),s(`
`),i("span",{class:"line"},[i("span",null,"boolean          →    int (0/1)")]),s(`
`),i("span",{class:"line"},[i("span",null,"table            →    结构体指针 / 数组指针")]),s(`
`),i("span",{class:"line"},[i("span",null,"function         →    函数指针")]),s(`
`),i("span",{class:"line"},[i("span",null,"userdata         →    void* (任意 C 对象)")]),s(`
`),i("span",{class:"line"},[i("span",null,"nil              →    NULL")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[73]||(l[73]=i("p",null,[i("strong",null,"2. 参数封送（Marshalling）")],-1)),l[74]||(l[74]=i("p",null,"在调用发生前，FFI 需要将高级语言的数据转换为 C 能够理解的格式：",-1)),l[75]||(l[75]=i("ul",null,[i("li",null,[s("将 Lua 的字符串转换为 C 的 "),i("code",null,"char*"),s(" 指针")]),i("li",null,"将 Lua 的 table 转换为 C 的结构体"),i("li",null,"处理内存对齐和字节序问题")],-1)),l[76]||(l[76]=i("p",null,[i("strong",null,"3. 调用约定适配")],-1)),l[77]||(l[77]=i("p",null,"FFI 必须按照正确的调用约定来调用 C 函数：",-1)),l[78]||(l[78]=i("ul",null,[i("li",null,"将参数放入正确的寄存器或栈位置"),i("li",null,"保存和恢复必要的寄存器"),i("li",null,"正确处理返回值")],-1)),l[79]||(l[79]=i("p",null,[i("strong",null,"4. 结果解封（Unmarshalling）")],-1)),l[80]||(l[80]=i("p",null,"调用完成后，FFI 将 C 函数的返回值转换回高级语言的类型：",-1)),l[81]||(l[81]=i("ul",null,[i("li",null,[s("将 C 的 "),i("code",null,"char*"),s(" 转换为 Lua 的字符串（可能需要复制内存）")]),i("li",null,"将 C 的结构体指针包装为 Lua 的 userdata"),i("li",null,"处理错误和异常")],-1)),l[82]||(l[82]=i("h4",{id:"跨语言调用的底层机制详解",tabindex:"-1"},[s("跨语言调用的底层机制详解 "),i("a",{class:"header-anchor",href:"#跨语言调用的底层机制详解","aria-label":'Permalink to "跨语言调用的底层机制详解"'},"​")],-1)),l[83]||(l[83]=i("p",null,"让我们通过一个具体的例子来理解 FFI 的底层机制。假设 Lua 调用以下 C 函数：",-1)),l[84]||(l[84]=i("div",{class:"language-c"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// C 代码")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[85]||(l[85]=i("p",null,"在 Lua 中调用：",-1)),l[86]||(l[86]=i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- Lua 代码")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[87]||(l[87]=i("p",null,"底层发生的事情：",-1)),l[88]||(l[88]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"Lua 解释器识别函数调用"),s("：Lua VM 发现 "),i("code",null,"add"),s(" 是一个 C 函数（通过元表或注册表）")])]),i("li",null,[i("p",null,[i("strong",null,"参数准备"),s("：")]),i("ul",null,[i("li",null,"Lua VM 从栈上取出两个参数（10 和 20）"),i("li",null,"检查类型是否为 number"),i("li",null,"将 Lua number（通常是 double）转换为 C int")])]),i("li",null,[i("p",null,[i("strong",null,"调用 C 函数"),s("：")]),i("ul",null,[i("li",null,"按照 C 调用约定（如 cdecl 或 x64 calling convention）将参数放入寄存器或栈"),i("li",null,"执行 CALL 指令跳转到 C 函数地址"),i("li",null,"C 函数执行，将结果放入 rax 寄存器（x64）或栈上")])]),i("li",null,[i("p",null,[i("strong",null,"返回值处理"),s("：")]),i("ul",null,[i("li",null,"Lua VM 从约定的位置获取返回值"),i("li",null,"将 C int 转换为 Lua number"),i("li",null,"将结果压入 Lua 栈")])]),i("li",null,[i("p",null,[i("strong",null,"继续执行"),s("：Lua VM 继续执行后续的 Lua 代码")])])],-1)),l[89]||(l[89]=i("h3",{id:"_2-4-动态库与静态库",tabindex:"-1"},[s("2.4 动态库与静态库 "),i("a",{class:"header-anchor",href:"#_2-4-动态库与静态库","aria-label":'Permalink to "2.4 动态库与静态库"'},"​")],-1)),l[90]||(l[90]=i("h4",{id:"为什么跨语言调用必须使用动态库",tabindex:"-1"},[s("为什么跨语言调用必须使用动态库 "),i("a",{class:"header-anchor",href:"#为什么跨语言调用必须使用动态库","aria-label":'Permalink to "为什么跨语言调用必须使用动态库"'},"​")],-1)),l[91]||(l[91]=i("p",null,[s("跨语言调用几乎总是依赖"),i("strong",null,"动态链接库"),s("（Dynamic Link Library），原因如下：")],-1)),l[92]||(l[92]=i("p",null,[i("strong",null,"1. 运行时加载的需求")],-1)),l[93]||(l[93]=i("p",null,[s("脚本语言通常在运行时才决定要调用哪些原生函数。动态库可以在程序运行时通过 "),i("code",null,"dlopen"),s("（Linux）或 "),i("code",null,"LoadLibrary"),s("（Windows）动态加载，而静态库必须在编译时链接。")],-1)),l[94]||(l[94]=i("p",null,[i("strong",null,"2. 代码共享")],-1)),l[95]||(l[95]=i("p",null,"多个脚本虚拟机实例可以共享同一个动态库的代码段，节省内存。例如，多个 Lua 虚拟机可以共享同一个 C 扩展库。",-1)),l[96]||(l[96]=i("p",null,[i("strong",null,"3. 独立更新")],-1)),l[97]||(l[97]=i("p",null,[s("动态库可以独立于脚本引擎进行更新。修复 C 库的 Bug 时，只需替换 "),i("code",null,".so"),s(" 或 "),i("code",null,".dll"),s(" 文件，无需重新编译整个应用。")],-1)),l[98]||(l[98]=i("p",null,[i("strong",null,"4. 语言无关性")],-1)),l[99]||(l[99]=i("p",null,"动态库提供了标准的 C ABI 接口，任何支持 FFI 的语言都可以调用，实现了真正的语言无关性。",-1)),l[100]||(l[100]=i("h4",{id:"静态库为什么不适用于跨语言调用",tabindex:"-1"},[s("静态库为什么不适用于跨语言调用 "),i("a",{class:"header-anchor",href:"#静态库为什么不适用于跨语言调用","aria-label":'Permalink to "静态库为什么不适用于跨语言调用"'},"​")],-1)),l[101]||(l[101]=i("p",null,[s("静态库（"),i("code",null,".a"),s(" 或 "),i("code",null,".lib"),s("）在编译时被链接到可执行文件中，存在以下问题：")],-1)),l[102]||(l[102]=i("p",null,[i("strong",null,"1. 无法运行时加载")],-1)),l[103]||(l[103]=i("p",null,"静态库的代码在编译时就被合并到可执行文件中，脚本语言无法在运行时动态加载静态库中的函数。",-1)),l[104]||(l[104]=i("p",null,[i("strong",null,"2. 符号冲突")],-1)),l[105]||(l[105]=i("p",null,"如果多个静态库包含同名符号，链接时会产生冲突。动态库通过符号隔离机制（如命名空间、符号版本）可以避免这个问题。",-1)),l[106]||(l[106]=i("p",null,[i("strong",null,"3. 内存浪费")],-1)),l[107]||(l[107]=i("p",null,"每个使用静态库的程序都会包含一份库代码的副本，造成磁盘和内存浪费。",-1)),l[108]||(l[108]=i("p",null,[i("strong",null,"4. 缺乏 ABI 稳定性")],-1)),l[109]||(l[109]=i("p",null,"静态库的内部实现细节（如 C++ 的 name mangling）会暴露给链接器，不同编译器编译的静态库可能无法链接在一起。",-1)),l[110]||(l[110]=i("h4",{id:"动态库的符号导出和加载机制",tabindex:"-1"},[s("动态库的符号导出和加载机制 "),i("a",{class:"header-anchor",href:"#动态库的符号导出和加载机制","aria-label":'Permalink to "动态库的符号导出和加载机制"'},"​")],-1)),l[111]||(l[111]=i("p",null,[i("strong",null,"符号导出（Symbol Export）")],-1)),l[112]||(l[112]=i("p",null,"在 C/C++ 中，需要显式标记哪些函数可以被外部调用：",-1)),l[113]||(l[113]=i("div",{class:"language-c"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Windows (MSVC)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__declspec"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dllexport) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Linux/macOS (GCC/Clang)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"__attribute__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"visibility"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"default"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"))) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 跨平台宏定义")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#ifdef"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," _WIN32")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    #define"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EXPORT"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," __declspec"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dllexport)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    #define"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EXPORT"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," __attribute__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"visibility"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"default"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")))")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#endif")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"EXPORT "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," b;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[114]||(l[114]=i("p",null,[i("strong",null,"符号加载（Symbol Loading）")],-1)),l[115]||(l[115]=i("p",null,"脚本语言通过 FFI 加载动态库并获取函数地址：",-1)),l[116]||(l[116]=i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- LuaJIT FFI 示例")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ffi "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," require"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ffi"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 声明 C 函数签名")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ffi."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cdef"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[[")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"]]")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 加载动态库")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," mylib "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ffi."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"load"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mylib"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 自动查找 mylib.so 或 mylib.dll")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 调用 C 函数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," mylib."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(result)  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 输出 30")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[117]||(l[117]=i("h4",{id:"示例",tabindex:"-1"},[s("示例 "),i("a",{class:"header-anchor",href:"#示例","aria-label":'Permalink to "示例"'},"​")],-1)),l[118]||(l[118]=i("p",null,"假设我们使用 C++ 编写了一个高性能的物理引擎，需要在 Lua 脚本中调用：",-1)),l[119]||(l[119]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"编译为动态库")])]),i("li",null,[i("p",null,[i("strong",null,"导出 C 接口"),s("：")]),i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// physics.h")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extern"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    EXPORT "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void*"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CreateRigidBody"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," mass);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    EXPORT "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ApplyForce"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," body, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," x, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," y, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," z);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    EXPORT "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DestroyRigidBody"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," body);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"Lua 中调用"),s("：")]),i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ffi "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," require"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"ffi"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ffi."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"cdef"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"[[")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void*"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," CreateRigidBody"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," mass"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ApplyForce"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," body"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," x"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," y"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"float"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," z"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," DestroyRigidBody"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," body"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"]]")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," physics "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ffi."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"load"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"physics"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 创建刚体")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," body "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," physics."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"CreateRigidBody"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10.0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 施加力")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"physics."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"ApplyForce"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(body, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 销毁刚体")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"physics."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"DestroyRigidBody"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(body)")])])]),i("button",{class:"code-block-unfold-btn"})])])],-1)),l[120]||(l[120]=i("p",null,"这种方式使得性能关键的物理计算在 C++ 中执行，而游戏逻辑在 Lua 中编写，兼顾了性能和开发效率。",-1)),l[121]||(l[121]=i("h3",{id:"_2-5-语言绑定-binding",tabindex:"-1"},[s("2.5 语言绑定（Binding） "),i("a",{class:"header-anchor",href:"#_2-5-语言绑定-binding","aria-label":'Permalink to "2.5 语言绑定（Binding）"'},"​")],-1)),l[122]||(l[122]=i("h4",{id:"什么是语言绑定及其必要性",tabindex:"-1"},[s("什么是语言绑定及其必要性 "),i("a",{class:"header-anchor",href:"#什么是语言绑定及其必要性","aria-label":'Permalink to "什么是语言绑定及其必要性"'},"​")],-1)),l[123]||(l[123]=i("p",null,[i("strong",null,"语言绑定"),s("（Language Binding）是指为原生代码（通常是 C/C++）创建一层包装代码，使其能够被脚本语言调用。绑定层的主要职责包括：")],-1)),l[124]||(l[124]=i("ol",null,[i("li",null,[i("strong",null,"类型转换"),s("：在脚本类型和 C 类型之间进行转换")]),i("li",null,[i("strong",null,"对象生命周期管理"),s("：管理 C++ 对象的创建和销毁")]),i("li",null,[i("strong",null,"异常处理"),s("：将 C++ 异常转换为脚本语言的错误机制")]),i("li",null,[i("strong",null,"API 适配"),s("：将面向对象的 C++ API 转换为脚本友好的接口")])],-1)),l[125]||(l[125]=i("p",null,[i("strong",null,"为什么需要绑定？")],-1)),l[126]||(l[126]=i("p",null,"虽然 FFI 可以直接调用 C 函数，但对于复杂的 C++ API（类、继承、模板、重载等），直接调用非常困难：",-1)),l[127]||(l[127]=i("ul",null,[i("li",null,"C++ 的 name mangling 使得函数名不可预测"),i("li",null,"C++ 的对象模型（虚函数表、多重继承）与脚本语言不兼容"),i("li",null,"C++ 的 RAII 和异常机制需要特殊处理")],-1)),l[128]||(l[128]=i("p",null,"绑定层将 C++ 的复杂性隐藏起来，提供简洁的 C 接口或脚本友好的 API。",-1)),l[129]||(l[129]=i("h4",{id:"手写绑定的方法和优缺点",tabindex:"-1"},[s("手写绑定的方法和优缺点 "),i("a",{class:"header-anchor",href:"#手写绑定的方法和优缺点","aria-label":'Permalink to "手写绑定的方法和优缺点"'},"​")],-1)),l[130]||(l[130]=i("p",null,[i("strong",null,"手写绑定示例"),s("（Lua C API）：")],-1)),l[131]||(l[131]=i("p",null,"假设有以下 C++ 类：",-1)),l[132]||(l[132]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Player.h")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," std"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"string"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," health"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," GetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," damage"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    std"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::string name_;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," health_;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[133]||(l[133]=i("p",null,"手写 Lua 绑定：",-1)),l[134]||(l[134]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// player_binding.cpp")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#include"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," <lua.hpp>")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#include"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Player.h"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 创建 Player 对象")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_Player_new"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," char*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," name "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," luaL_checkstring"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 在 Lua 管理的内存中创建 Player 对象")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," udata "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_newuserdata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"sizeof"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"udata "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(name);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 设置元表")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    luaL_getmetatable"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_setmetatable"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 返回 userdata")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 设置生命值")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_Player_SetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," udata "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," health "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," luaL_checkinteger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"udata)->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"SetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(health);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 获取生命值")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_Player_GetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," udata "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," health "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"udata)->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"GetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_pushinteger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, health);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 攻击")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_Player_Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," self "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," target "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," damage "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," luaL_checkinteger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"self)->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"target, damage);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 垃圾回收")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_Player_gc"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," udata "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    delete"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"udata;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 注册到 Lua")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," luaopen_player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 创建元表")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    luaL_newmetatable"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 设置 __gc 元方法")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_pushcfunction"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, lua_Player_gc);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_setfield"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"__gc"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 设置 __index 为自身（方法查找）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_pushvalue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_setfield"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"__index"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 注册方法")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    luaL_Reg methods[] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"SetHealth"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", lua_Player_SetHealth},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"GetHealth"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", lua_Player_GetHealth},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Attack"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", lua_Player_Attack},")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        {"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"NULL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"NULL"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    };")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    luaL_setfuncs"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, methods, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 注册构造函数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_newtable"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_pushcfunction"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, lua_Player_new);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_setfield"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"new"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[135]||(l[135]=i("p",null,"在 Lua 中使用：",-1)),l[136]||(l[136]=i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Player "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," require"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," player1 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Player."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"new"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Alice"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," player2 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Player."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"new"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Bob"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"player1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"SetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"player2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"SetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"player1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(player2, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"player2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"GetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"-- 输出 80")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[137]||(l[137]=i("h4",{id:"自动生成绑定的工具和方案",tabindex:"-1"},[s("自动生成绑定的工具和方案 "),i("a",{class:"header-anchor",href:"#自动生成绑定的工具和方案","aria-label":'Permalink to "自动生成绑定的工具和方案"'},"​")],-1)),l[138]||(l[138]=i("p",null,"为了解决手写绑定的问题，业界开发了多种自动绑定生成工具。",-1)),l[139]||(l[139]=i("h5",{id:"swig-simplified-wrapper-and-interface-generator",tabindex:"-1"},[s("SWIG（Simplified Wrapper and Interface Generator） "),i("a",{class:"header-anchor",href:"#swig-simplified-wrapper-and-interface-generator","aria-label":'Permalink to "SWIG（Simplified Wrapper and Interface Generator）"'},"​")],-1)),l[140]||(l[140]=i("p",null,[i("strong",null,"SWIG"),s(" 是最古老、最成熟的跨语言绑定生成工具，支持 40+ 种语言。")],-1)),l[141]||(l[141]=i("p",null,[i("strong",null,"工作原理"),s("：")],-1)),l[142]||(l[142]=i("ol",null,[i("li",null,[s("解析 C/C++ 头文件或 SWIG 接口文件（"),i("code",null,".i"),s("）")]),i("li",null,"生成目标语言的绑定代码"),i("li",null,"编译生成的代码为动态库")],-1)),l[143]||(l[143]=i("p",null,[i("strong",null,"示例"),s("（为 Lua 生成绑定）：")],-1)),l[144]||(l[144]=i("div",{class:"language-swig"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"swig"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"// player.i")]),s(`
`),i("span",{class:"line"},[i("span",null,"%module player")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,"%{")]),s(`
`),i("span",{class:"line"},[i("span",null,'#include "Player.h"')]),s(`
`),i("span",{class:"line"},[i("span",null,"\\%\\}")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,'%include "Player.h"')])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[145]||(l[145]=i("p",null,"生成绑定：",-1)),l[146]||(l[146]=i("div",{class:"language-bash"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"bash"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"swig"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -c++"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -lua"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," player.i")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"g++"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -shared"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -fPIC"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," player_wrap.cxx"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," Player.cpp"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -o"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," player.so"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -llua")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[147]||(l[147]=i("p",null,"在 Lua 中使用：",-1)),l[148]||(l[148]=i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," player "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," require"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," p1 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," player."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Alice"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"p1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"SetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"p1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"GetHealth"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[149]||(l[149]=i("h5",{id:"puerts-unity-ue-javascript-typescript-绑定",tabindex:"-1"},[s("Puerts（Unity/UE JavaScript/TypeScript 绑定） "),i("a",{class:"header-anchor",href:"#puerts-unity-ue-javascript-typescript-绑定","aria-label":'Permalink to "Puerts（Unity/UE JavaScript/TypeScript 绑定）"'},"​")],-1)),l[150]||(l[150]=i("p",null,[i("strong",null,"Puerts"),s(" 是腾讯开源的 Unity/UE JavaScript/TypeScript 解决方案，基于 V8/QuickJS 引擎。")],-1)),l[151]||(l[151]=i("p",null,[i("strong",null,"工作原理"),s("：")],-1)),l[152]||(l[152]=i("ol",null,[i("li",null,"使用 C# 反射或静态代码生成"),i("li",null,"自动为 C# 类生成 JavaScript 绑定"),i("li",null,"通过 V8 的 C++ API 桥接 C# 和 JavaScript")],-1)),l[153]||(l[153]=i("p",null,[i("strong",null,"示例"),s("：")],-1)),l[154]||(l[154]=i("div",{class:"language-csharp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"csharp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// C# 代码（Unity）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," string"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Name"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Health"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Player"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," damage"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        target.Health "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," damage;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[155]||(l[155]=i("p",null,"在 TypeScript 中使用（无需手写绑定）：",-1)),l[156]||(l[156]=i("div",{class:"language-typescript"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"typescript"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { Player } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'csharp'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," player1 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"player1.Name "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Alice"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"player1.Health "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," player2 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"player2.Name "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "Bob"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"player2.Health "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"player1."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(player2, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(player2.Health);  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 输出 80")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[157]||(l[157]=i("h4",{id:"类型映射的原理和实现",tabindex:"-1"},[s("类型映射的原理和实现 "),i("a",{class:"header-anchor",href:"#类型映射的原理和实现","aria-label":'Permalink to "类型映射的原理和实现"'},"​")],-1)),l[158]||(l[158]=i("p",null,"类型映射是绑定层的核心任务之一。不同语言的类型系统差异很大，需要建立合理的映射关系。",-1)),l[159]||(l[159]=i("p",null,[i("strong",null,"基本类型映射"),s("：不同语言之间需要建立类型对应关系，例如 C/C++ 的 "),i("code",null,"int"),s(" 对应 Lua 的 "),i("code",null,"number"),s("、JavaScript 的 "),i("code",null,"number"),s("、C# 的 "),i("code",null,"int"),s("；C/C++ 的 "),i("code",null,"char*"),s(" 对应各语言的字符串类型；C/C++ 的 "),i("code",null,"void*"),s(" 对应 Lua 的 "),i("code",null,"userdata"),s("、JavaScript 的 "),i("code",null,"ArrayBuffer"),s("、C# 的 "),i("code",null,"IntPtr"),s("。")],-1)),l[160]||(l[160]=i("p",null,[i("strong",null,"复杂类型映射"),s("：")],-1)),l[161]||(l[161]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"数组"),s("：")]),i("ul",null,[i("li",null,[s("C: "),i("code",null,"int arr[10]"),s(" → Lua: table / JS: Array / C#: int[]")]),i("li",null,"需要处理：长度信息、内存拷贝 vs 引用")])]),i("li",null,[i("p",null,[i("strong",null,"结构体"),s("：")]),i("ul",null,[i("li",null,[s("C: "),i("code",null,"struct Point { float x, y; }"),s(" → Lua: table / JS: object / C#: struct")]),i("li",null,"需要处理：内存布局、对齐、字节序")])]),i("li",null,[i("p",null,[i("strong",null,"函数指针"),s("：")]),i("ul",null,[i("li",null,[s("C: "),i("code",null,"void (*callback)(int)"),s(" → Lua: function / JS: function / C#: delegate")]),i("li",null,"需要处理：闭包捕获、生命周期")])]),i("li",null,[i("p",null,[i("strong",null,"对象"),s("：")]),i("ul",null,[i("li",null,[s("C++: "),i("code",null,"class Player"),s(" → Lua: userdata + metatable / JS: object / C#: class")]),i("li",null,"需要处理：继承、多态、虚函数")])])],-1)),l[162]||(l[162]=i("h2",{id:"三、实现机制",tabindex:"-1"},[s("三、实现机制 "),i("a",{class:"header-anchor",href:"#三、实现机制","aria-label":'Permalink to "三、实现机制"'},"​")],-1)),l[163]||(l[163]=i("h3",{id:"_3-1-运行时桥接机制",tabindex:"-1"},[s("3.1 运行时桥接机制 "),i("a",{class:"header-anchor",href:"#_3-1-运行时桥接机制","aria-label":'Permalink to "3.1 运行时桥接机制"'},"​")],-1)),l[164]||(l[164]=i("h4",{id:"跨语言调用链的完整流程",tabindex:"-1"},[s("跨语言调用链的完整流程 "),i("a",{class:"header-anchor",href:"#跨语言调用链的完整流程","aria-label":'Permalink to "跨语言调用链的完整流程"'},"​")],-1)),l[165]||(l[165]=i("p",null,"一次完整的跨语言调用涉及多个层次的转换。以 Lua 调用 C++ 为例：",-1)),l[166]||(l[166]=i("div",{class:"language-"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"}),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",null,"Lua 脚本代码")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"Lua VM（解释执行字节码）")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"Lua C API（栈操作）")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"绑定层（Wrapper/Binding）")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"C++ 对象方法")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"返回值")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"绑定层（类型转换）")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"Lua C API（压栈）")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"Lua VM（继续执行）")]),s(`
`),i("span",{class:"line"},[i("span",null,"    ↓")]),s(`
`),i("span",{class:"line"},[i("span",null,"Lua 脚本代码")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[167]||(l[167]=i("p",null,[i("strong",null,"详细流程"),s("：")],-1)),l[168]||(l[168]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"Lua 脚本调用"),s("：")]),i("div",{class:"language-lua"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"lua"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"local"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(target, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"Lua VM 查找方法"),s("：")]),i("ul",null,[i("li",null,[s("检查 "),i("code",null,"player"),s(" 的元表（metatable）")]),i("li",null,[s("在元表的 "),i("code",null,"__index"),s(" 中查找 "),i("code",null,"Attack"),s(" 方法")]),i("li",null,"找到对应的 C 函数指针")])]),i("li",null,[i("p",null,[i("strong",null,"调用 C 绑定函数"),s("：")]),i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_Player_Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 从 Lua 栈获取参数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," self "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," target "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"**"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"luaL_checkudata"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Player"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," damage "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," luaL_checkinteger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 调用 C++ 方法")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"self)->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"target, damage);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 返回值数量")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"执行 C++ 代码"),s("：")]),i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Player"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Attack"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Player"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," damage"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    target->health_ "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"-="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," damage;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"返回到 Lua"),s("：")]),i("ul",null,[i("li",null,"绑定函数返回"),i("li",null,"Lua VM 从栈上获取返回值"),i("li",null,"继续执行 Lua 代码")])])],-1)),l[169]||(l[169]=i("h4",{id:"各个环节的职责和实现细节",tabindex:"-1"},[s("各个环节的职责和实现细节 "),i("a",{class:"header-anchor",href:"#各个环节的职责和实现细节","aria-label":'Permalink to "各个环节的职责和实现细节"'},"​")],-1)),l[170]||(l[170]=i("p",null,"跨语言调用链中的各个环节分工明确：",-1)),l[171]||(l[171]=i("ul",null,[i("li",null,[i("strong",null,"脚本代码"),s("：负责业务逻辑，使用高级语言语法，易读易写")]),i("li",null,[i("strong",null,"虚拟机"),s("：负责解释执行，包括字节码解释、JIT 编译、内存管理")]),i("li",null,[i("strong",null,"语言 API"),s("：负责栈操作，提供 C API 操作虚拟机栈")]),i("li",null,[i("strong",null,"绑定层"),s("：负责类型转换，包括参数解封、调用原生函数、结果封送")]),i("li",null,[i("strong",null,"原生代码"),s("：负责核心逻辑，执行高性能计算、系统调用")])],-1)),l[172]||(l[172]=i("h4",{id:"不同语言桥接方案的差异对比",tabindex:"-1"},[s("不同语言桥接方案的差异对比 "),i("a",{class:"header-anchor",href:"#不同语言桥接方案的差异对比","aria-label":'Permalink to "不同语言桥接方案的差异对比"'},"​")],-1)),l[173]||(l[173]=i("h5",{id:"lua-的-c-api-桥接",tabindex:"-1"},[s("Lua 的 C API 桥接 "),i("a",{class:"header-anchor",href:"#lua-的-c-api-桥接","aria-label":'Permalink to "Lua 的 C API 桥接"'},"​")],-1)),l[174]||(l[174]=i("p",null,[i("strong",null,"特点"),s("：基于栈的设计，简单但需要手动管理栈。")],-1)),l[175]||(l[175]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 注册 C 函数到 Lua")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_pushcfunction"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, my_c_function);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_setglobal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"myFunction"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// C 函数实现")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," my_c_function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lua_State"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," L"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," arg1 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_tointeger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 获取第一个参数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," char*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," arg2 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," lua_tostring"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 获取第二个参数")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 执行逻辑")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," arg1 "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," strlen"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(arg2);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 压入返回值")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    lua_pushinteger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(L, result);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 返回值数量")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[176]||(l[176]=i("h5",{id:"javascript-typescript-的桥接-v8-嵌入式-embedding",tabindex:"-1"},[s("JavaScript/TypeScript 的桥接（V8 嵌入式 Embedding） "),i("a",{class:"header-anchor",href:"#javascript-typescript-的桥接-v8-嵌入式-embedding","aria-label":'Permalink to "JavaScript/TypeScript 的桥接（V8 嵌入式 Embedding）"'},"​")],-1)),l[177]||(l[177]=i("p",null,[i("strong",null,"特点"),s("：直接嵌入 V8 引擎，使用 V8 C++ API 将 C/C++ 函数暴露为 JS 函数；可脱离 Node.js 运行时，适合游戏/嵌入式脚本场景。")],-1)),l[178]||(l[178]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#include"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," <v8.h>")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#include"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," <libplatform/libplatform.h>")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"using"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," namespace"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," v8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// C++ -> JS 函数绑定")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MyFunctionCallback"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," FunctionCallbackInfo"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," args"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Isolate"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," isolate "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," args."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"GetIsolate"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Local"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Context"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ctx "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," isolate->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"GetCurrentContext"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int32_t"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," args["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Int32Value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ctx)."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"FromMaybe"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    String"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::Utf8Value "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"s"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate, args["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," a "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (s."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"length"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"strlen"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"s) "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    args."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"GetReturnValue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Integer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"New"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate, result));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," main"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," argc"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"char**"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," argv"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 初始化 V8 平台")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    V8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"InitializeICUDefaultLocation"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(argv["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    V8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"InitializeExternalStartupData"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(argv["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    std"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::unique_ptr"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Platform"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," platform "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," platform"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"NewDefaultPlatform"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    V8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"InitializePlatform"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(platform."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    V8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Initialize"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    Isolate"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::CreateParams params;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    params.array_buffer_allocator "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ArrayBuffer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Allocator"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"NewDefaultAllocator"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Isolate"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," isolate "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Isolate"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"New"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(params);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        Isolate"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::Scope "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isolate_scope"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        HandleScope "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"handle_scope"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 构建上下文并注册全局函数 myFunction")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Local"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"ObjectTemplate"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," global "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ObjectTemplate"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"New"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        global->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"String"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"NewFromUtf8Literal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate, "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"myFunction"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"),")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"                    FunctionTemplate"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"New"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate, MyFunctionCallback));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Local"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Context"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," context "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Context"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"New"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"nullptr"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", global);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        Context"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::Scope "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"context_scope"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(context);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 执行 JS 调用")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Local"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"String"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," source "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," String"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"NewFromUtf8Literal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(isolate, "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`"myFunction(42, 'hello')"`),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Local"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Script"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," script "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Script"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Compile"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(context, source)."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ToLocalChecked"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Local"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Value"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," script->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Run"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(context)."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ToLocalChecked"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        printf"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"%d\\n"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", result->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Int32Value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(context)."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"FromMaybe"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"));")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    isolate->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Dispose"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    V8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Dispose"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    V8"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ShutdownPlatform"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    delete"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," params.array_buffer_allocator;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[179]||(l[179]=i("h5",{id:"c-的-p-invoke-和-c-cli",tabindex:"-1"},[s("C# 的 P/Invoke 和 C++/CLI "),i("a",{class:"header-anchor",href:"#c-的-p-invoke-和-c-cli","aria-label":'Permalink to "C# 的 P/Invoke 和 C++/CLI"'},"​")],-1)),l[180]||(l[180]=i("p",null,[i("strong",null,"P/Invoke"),s("（调用 C 函数）")],-1)),l[181]||(l[181]=i("div",{class:"language-csharp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"csharp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"using"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," System"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"using"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," System"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Runtime"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"InteropServices"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Program"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 声明外部函数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    ["),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"DllImport"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"mylib.dll"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"CallingConvention"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," CallingConvention.Cdecl)]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extern"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," my_function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," arg1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"string"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," arg2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    static"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Main"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," result"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," my_function"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"42"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"hello"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Console."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"WriteLine"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(result);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[182]||(l[182]=i("p",null,[i("strong",null,"C++/CLI"),s("（混合编程）")],-1)),l[183]||(l[183]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ManagedWrapper.cpp")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#include"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "NativeClass.h"')]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"using"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," namespace"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," System"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"public ref "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ManagedWrapper"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    NativeClass"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," native;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    ManagedWrapper"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        native "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NativeClass"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    ~ManagedWrapper"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        delete"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," native;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MyMethod"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," arg1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"String"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"^"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," arg2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 转换 String^ 为 std::string")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        IntPtr ptr "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Marshal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"StringToHGlobalAnsi"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(arg2);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        std"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::string str "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static_cast<char*>"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ptr."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"ToPointer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        Marshal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"::"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"FreeHGlobal"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(ptr);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," native->"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"MyMethod"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(arg1, str);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[184]||(l[184]=i("h3",{id:"_3-2-调用约定",tabindex:"-1"},[s("3.2 调用约定 "),i("a",{class:"header-anchor",href:"#_3-2-调用约定","aria-label":'Permalink to "3.2 调用约定"'},"​")],-1)),l[185]||(l[185]=i("h4",{id:"调用约定的基本概念",tabindex:"-1"},[s("调用约定的基本概念 "),i("a",{class:"header-anchor",href:"#调用约定的基本概念","aria-label":'Permalink to "调用约定的基本概念"'},"​")],-1)),l[186]||(l[186]=i("p",null,"调用约定（Calling Convention）定义了函数调用时的底层细节，包括：",-1)),l[187]||(l[187]=i("ul",null,[i("li",null,"参数如何传递（寄存器还是栈）"),i("li",null,"返回值如何传递"),i("li",null,"谁负责清理栈（调用者还是被调用者）"),i("li",null,"寄存器的保存和恢复规则")],-1)),l[188]||(l[188]=i("p",null,[i("strong",null,"跨语言调用时，调用约定必须匹配"),s("，否则会导致栈损坏、参数错误等严重问题。")],-1)),l[189]||(l[189]=i("h4",{id:"参数传递和返回值机制",tabindex:"-1"},[s("参数传递和返回值机制 "),i("a",{class:"header-anchor",href:"#参数传递和返回值机制","aria-label":'Permalink to "参数传递和返回值机制"'},"​")],-1)),l[190]||(l[190]=i("h5",{id:"不同架构的调用约定",tabindex:"-1"},[s("不同架构的调用约定 "),i("a",{class:"header-anchor",href:"#不同架构的调用约定","aria-label":'Permalink to "不同架构的调用约定"'},"​")],-1)),l[191]||(l[191]=i("p",null,[i("strong",null,"32 位 x86 架构"),s("：")],-1)),l[192]||(l[192]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"cdecl"),s("（C Declaration）：")]),i("ul",null,[i("li",null,"参数从右到左压栈"),i("li",null,"调用者清理栈"),i("li",null,[s("返回值在 "),i("code",null,"eax"),s(" 寄存器")])]),i("div",{class:"language-asm"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"asm"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; int add(int a, int b)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; 调用 add(10, 20)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 20"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        ; 参数 b")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 10"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        ; 参数 a")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"call"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," add"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"       ; 调用函数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"add"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," esp"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 调用者清理栈（2 个参数 × 4 字节）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; 返回值在 eax")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"stdcall"),s("（Standard Call）：")]),i("ul",null,[i("li",null,"参数从右到左压栈"),i("li",null,"被调用者清理栈"),i("li",null,"Windows API 常用")]),i("div",{class:"language-asm"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"asm"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; int __stdcall add(int a, int b)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 20")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 10")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"call"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," add"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"       ; 函数内部会清理栈")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; 不需要调用者清理")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"fastcall"),s("：")]),i("ul",null,[i("li",null,[s("前两个参数通过 "),i("code",null,"ecx"),s(" 和 "),i("code",null,"edx"),s(" 寄存器传递")]),i("li",null,"其余参数压栈"),i("li",null,"被调用者清理栈")]),i("div",{class:"language-asm"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"asm"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; int __fastcall add(int a, int b, int c)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," ecx"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    ; 第一个参数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," edx"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    ; 第二个参数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 30"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        ; 第三个参数")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"call"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," add")])])]),i("button",{class:"code-block-unfold-btn"})])])],-1)),l[193]||(l[193]=i("p",null,[i("strong",null,"64 位 x86-64 架构"),s("：")],-1)),l[194]||(l[194]=i("p",null,"64 位系统统一了调用约定，大量使用寄存器传参，性能更高。",-1)),l[195]||(l[195]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"Windows x64 调用约定"),s("：")]),i("ul",null,[i("li",null,[s("前 4 个整数/指针参数："),i("code",null,"rcx"),s(", "),i("code",null,"rdx"),s(", "),i("code",null,"r8"),s(", "),i("code",null,"r9")]),i("li",null,[s("前 4 个浮点参数："),i("code",null,"xmm0"),s(", "),i("code",null,"xmm1"),s(", "),i("code",null,"xmm2"),s(", "),i("code",null,"xmm3")]),i("li",null,"其余参数压栈"),i("li",null,'调用者分配 32 字节"影子空间"（shadow space）'),i("li",null,[s("返回值在 "),i("code",null,"rax"),s("（整数）或 "),i("code",null,"xmm0"),s("（浮点）")])]),i("div",{class:"language-asm"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"asm"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; int add(int a, int b, int c, int d, int e)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; 调用 add(1, 2, 3, 4, 5)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"sub"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," rsp"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"40"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    ; 分配影子空间（32）+ 第 5 个参数（8）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," ecx"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 a")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," edx"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 b")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," r8d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 c")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," r9d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"4"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 d")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"rsp"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"+"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"32"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"], "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  ; 参数 e（栈上）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"call"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," add")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"add"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," rsp"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"40"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    ; 清理栈")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"System V AMD64 ABI"),s("（Linux、macOS）：")]),i("ul",null,[i("li",null,[s("前 6 个整数/指针参数："),i("code",null,"rdi"),s(", "),i("code",null,"rsi"),s(", "),i("code",null,"rdx"),s(", "),i("code",null,"rcx"),s(", "),i("code",null,"r8"),s(", "),i("code",null,"r9")]),i("li",null,[s("前 8 个浮点参数："),i("code",null,"xmm0"),s("-"),i("code",null,"xmm7")]),i("li",null,"其余参数压栈"),i("li",null,"无影子空间"),i("li",null,[s("返回值在 "),i("code",null,"rax"),s("/"),i("code",null,"xmm0")])]),i("div",{class:"language-asm"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"asm"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"; 调用 add(1, 2, 3, 4, 5, 6, 7)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," edi"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," esi"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 2")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," edx"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 3")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," ecx"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"4"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 4")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," r8d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 5")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"mov"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," r9d"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"6"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 参数 6")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"push"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 7"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"         ; 参数 7（栈上）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"call"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," add")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"add"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," rsp"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     ; 清理栈")])])]),i("button",{class:"code-block-unfold-btn"})])])],-1)),l[196]||(l[196]=i("h5",{id:"返回值的传递机制",tabindex:"-1"},[s("返回值的传递机制 "),i("a",{class:"header-anchor",href:"#返回值的传递机制","aria-label":'Permalink to "返回值的传递机制"'},"​")],-1)),l[197]||(l[197]=i("p",null,[i("strong",null,"简单类型"),s("：")],-1)),l[198]||(l[198]=i("ul",null,[i("li",null,[s("整数、指针："),i("code",null,"rax"),s("（64位）或 "),i("code",null,"eax"),s("（32位）")]),i("li",null,[s("浮点数："),i("code",null,"xmm0")]),i("li",null,[s("布尔值："),i("code",null,"al"),s("（"),i("code",null,"rax"),s(" 的低 8 位）")])],-1)),l[199]||(l[199]=i("p",null,[i("strong",null,"复杂类型"),s("：")],-1)),l[200]||(l[200]=i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"小结构体"),s("（≤ 16 字节）：")]),i("ul",null,[i("li",null,"Windows x64：通过隐藏的指针参数返回（调用者分配空间）"),i("li",null,[s("System V AMD64：通过 "),i("code",null,"rax"),s(" 和 "),i("code",null,"rdx"),s(" 返回（最多 16 字节）")])]),i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"struct"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Point"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," x, y; };"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 8 字节")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"Point"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," GetPoint"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"20"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// System V AMD64：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// rax = 0x0000001400000014  (低 32 位是 x，高 32 位是 y)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Windows x64：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 调用者传递隐藏参数（指向返回值的指针）")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// void GetPoint(Point* __return);")])])]),i("button",{class:"code-block-unfold-btn"})])]),i("li",null,[i("p",null,[i("strong",null,"大结构体"),s("（> 16 字节）：")]),i("ul",null,[i("li",null,"调用者分配空间"),i("li",null,"将指针作为隐藏的第一个参数传递"),i("li",null,"被调用者将结果写入该地址")]),i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"struct"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," BigStruct"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," data["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"]; };")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"BigStruct"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," GetBigStruct"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    BigStruct result;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ...")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," result;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 实际编译为：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// void GetBigStruct(BigStruct* __return) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     // 填充 __return")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// }")])])]),i("button",{class:"code-block-unfold-btn"})])])],-1)),l[201]||(l[201]=i("h5",{id:"栈的清理责任划分",tabindex:"-1"},[s("栈的清理责任划分 "),i("a",{class:"header-anchor",href:"#栈的清理责任划分","aria-label":'Permalink to "栈的清理责任划分"'},"​")],-1)),l[202]||(l[202]=i("p",null,"不同调用约定的栈清理责任和特点：",-1)),l[203]||(l[203]=i("ul",null,[i("li",null,[i("strong",null,"cdecl"),s("：调用者负责清理栈。优点是支持可变参数（如 printf），缺点是代码体积大（每个调用点都有清理代码）")]),i("li",null,[i("strong",null,"stdcall"),s("：被调用者负责清理栈。优点是代码体积小，缺点是不支持可变参数")]),i("li",null,[i("strong",null,"fastcall"),s("：被调用者负责清理栈。优点是性能高（寄存器传参），缺点是参数数量有限")]),i("li",null,[i("strong",null,"x64"),s("：调用者负责清理栈。优点是统一标准")])],-1)),l[204]||(l[204]=i("p",null,[i("strong",null,"为什么 cdecl 支持可变参数？")],-1)),l[205]||(l[205]=i("div",{class:"language-c"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"c"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," printf"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," char*"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," format"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", ...);")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 调用")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"printf"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"%d"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," %s"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"42"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"hello"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[206]||(l[206]=i("p",null,[s("被调用者（"),i("code",null,"printf"),s("）不知道有多少个参数，因此无法清理栈。只有调用者知道传递了多少参数，所以必须由调用者清理。")],-1)),l[207]||(l[207]=i("h3",{id:"_3-3-平台和编译器的-abi-差异",tabindex:"-1"},[s("3.3 平台和编译器的 ABI 差异 "),i("a",{class:"header-anchor",href:"#_3-3-平台和编译器的-abi-差异","aria-label":'Permalink to "3.3 平台和编译器的 ABI 差异"'},"​")],-1)),l[208]||(l[208]=i("h4",{id:"windows-vs-linux-vs-macos",tabindex:"-1"},[s("Windows vs Linux vs macOS "),i("a",{class:"header-anchor",href:"#windows-vs-linux-vs-macos","aria-label":'Permalink to "Windows vs Linux vs macOS"'},"​")],-1)),l[209]||(l[209]=i("p",null,"不同平台的 ABI 差异：",-1)),l[210]||(l[210]=i("ul",null,[i("li",null,[i("strong",null,"调用约定"),s("：Windows 使用 Windows x64，Linux 和 macOS 使用 System V AMD64")]),i("li",null,[i("strong",null,"参数寄存器"),s("：Windows 使用 rcx、rdx、r8、r9；Linux/macOS 使用 rdi、rsi、rdx、rcx、r8、r9")]),i("li",null,[i("strong",null,"栈对齐"),s("：所有平台都要求 16 字节对齐")]),i("li",null,[i("strong",null,"动态库扩展名"),s("：Windows 使用 .dll，Linux 使用 .so，macOS 使用 .dylib")]),i("li",null,[i("strong",null,"符号导出"),s("：Windows 使用 "),i("code",null,"__declspec(dllexport)"),s("，Linux/macOS 使用 "),i("code",null,'__attribute__((visibility("default")))')]),i("li",null,[i("strong",null,"C++ name mangling"),s("：Windows 使用 MSVC 风格，Linux/macOS 使用 Itanium ABI")])],-1)),l[211]||(l[211]=i("p",null,[i("strong",null,"跨平台兼容性问题"),s("：")],-1)),l[212]||(l[212]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 错误：假设 Windows 调用约定")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#ifdef"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," _WIN32")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"__declspec("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"dllexport"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},")"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#endif")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},'// 正确：使用 extern "C" 避免 name mangling')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extern"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#ifdef"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," _WIN32")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    __declspec"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(dllexport)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#else")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"    __attribute__"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"visibility"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"default"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")))")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"#endif")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[213]||(l[213]=i("h4",{id:"msvc-vs-gcc-vs-clang",tabindex:"-1"},[s("MSVC vs GCC vs Clang "),i("a",{class:"header-anchor",href:"#msvc-vs-gcc-vs-clang","aria-label":'Permalink to "MSVC vs GCC vs Clang"'},"​")],-1)),l[214]||(l[214]=i("p",null,"不同编译器会存在 ABI 差异：",-1)),l[215]||(l[215]=i("ul",null,[i("li",null,[i("strong",null,"MSVC"),s("：使用专有的 C++ ABI，Name Mangling 格式如 "),i("code",null,"?add@@YAHHH@Z"),s("，仅与 MSVC 编译的代码兼容")]),i("li",null,[i("strong",null,"GCC"),s("：使用 Itanium C++ ABI，Name Mangling 格式如 "),i("code",null,"_Z3addii"),s("，与 Clang 兼容")]),i("li",null,[i("strong",null,"Clang"),s("：使用 Itanium C++ ABI，Name Mangling 格式如 "),i("code",null,"_Z3addii"),s("，与 GCC 兼容")])],-1)),l[216]||(l[216]=i("p",null,[i("strong",null,"Name Mangling 示例"),s("：")],-1)),l[217]||(l[217]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"double"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"double"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 重载")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// MSVC：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ?add@@YAHHH@Z")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ?add@@YANNN@Z")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// GCC/Clang：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// _Z3addii")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// _Z3adddd")])])]),i("button",{class:"code-block-unfold-btn"})],-1)),l[218]||(l[218]=i("p",null,[i("strong",null,"解决方案"),s("：使用 "),i("code",null,'extern "C"'),s(" 禁用 name mangling")],-1)),l[219]||(l[219]=i("div",{class:"language-cpp"},[i("button",{title:"Copy code",class:"copy"}),i("span",{class:"lang"},"cpp"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"extern"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "C"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    int"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add_int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    double"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," add_double"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"double"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," a"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"double"),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}}," b"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 编译后：")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// add_int")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// add_double")])])]),i("button",{class:"code-block-unfold-btn"})],-1))]),"main-header":a(()=>[h(k.$slots,"main-header")]),"main-header-after":a(()=>[h(k.$slots,"main-header-after")]),"main-nav":a(()=>[h(k.$slots,"main-nav")]),"main-content-before":a(()=>[h(k.$slots,"main-content-before")]),"main-content":a(()=>[h(k.$slots,"main-content")]),"main-content-after":a(()=>[h(k.$slots,"main-content-after")]),"main-nav-before":a(()=>[h(k.$slots,"main-nav-before")]),"main-nav-after":a(()=>[h(k.$slots,"main-nav-after")]),comment:a(()=>[h(k.$slots,"comment")]),footer:a(()=>[h(k.$slots,"footer")]),aside:a(()=>[h(k.$slots,"aside")]),"aside-custom":a(()=>[h(k.$slots,"aside-custom")]),default:a(()=>[h(k.$slots,"default")]),_:3},8,["frontmatter"])}}};export{G as default,B as usePageData};
